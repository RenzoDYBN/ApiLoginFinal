<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="../css/homestyle.css">
    <link href="../css/buscar-usuario.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/ec9265bfa6.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css" integrity="sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js" integrity="sha384-BOsAfwzjNJHrJ8cZidOg56tcQWfp6y72vEJ8xQ9w6Quywb24iOsW913URv1IS4GD" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.12.0/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>

    <script src="https://cdn.datatables.net/1.12.0/js/dataTables.bootstrap5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.2/dist/sweetalert2.min.css">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap5.min.css">
    <title>Buscar Usuario</title>
</head>

<body>
    {{> navhomebar}}
    <div class="container">
        <h1 class="mt-4 mb-4 text-center text-primary"></h1>

        <span id="message"></span>
        <span id="bueno"></span>
                
    
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col col-sm-9">Registrar Usuario</div>
                    {{!-- \{{#if msg}}
                     <p class="\{{msg_type}}">\{{msg}}</p>
                    \{{/if}} --}}
                    <div class="col col-sm-3">
                        <button type="button" id="add_data" class="btn btn-success btn-sm float-end">Add</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" id="sample_data">
                        <thead>
                            <tr>
                                <th>Id</th>
                              <th>Dni</th>
                            <th>Codigo Rol</th>
                            <th>Nombre Usuario</th>
                          <th>Contraseña</th>
                         <th>Estado Usuario</th>
                         <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<div class="modal" tabindex="-1" id="action_modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" id="sample_form">
                <div class="modal-header" id="dynamic_modal_title">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">dni_persona</label>
                        <input type="number" name="dni_persona" id="dni_persona" class="form-control" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nombre Usuario</label>
                        <input type="text" name="nombre_usuario" id="nombre_usuario" class="form-control" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contraseña</label>
                        <input type="password" name="password" id="password" class="form-control" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contraseña</label>
                        <input type="password" name="cpassword" id="cpassword" class="form-control" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Seleeciona el Rol</label>
                        <select name="codigo_rol" id="codigo_rol" class="form-control">
                            <option value=""></option>
                            <option value="1">Administrador</option>
                            <option value="2">Produccion</option>
                            <option value="3">RRHH</option>
                            <option value="4">Ventas</option>
                            <option value="5">Almacen</option>
                            <option value="6">Gerencia</option>
                            <option value="7">Contabilidad</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="hidden" name="id" id="id" />
                    <input type="hidden" name="action" id="action" value="Add" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="action_button">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap5.min.js"></script>        
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.min.js" integrity="sha384-5h4UG+6GOuV9qXh6HqOLwZMY4mnLPraeTrjT5v07o347pj6IkfuoASuGBhfDsp3d" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.2/dist/sweetalert2.all.min.js"></script>
<script>

    
    $(document).ready(function() {

    load_data();
    function load_data() {
        $('#sample_data').DataTable({    
    ajax: {
        url: "/data",
        dataSrc: ""
    },   
    columns: [ 
    {"data":"usuario"},
    {"data":"dni_persona"},
    {"data":"codigo_rol"},
    {"data":"nombre_usuario"},
    {"data":"pass"},
    {"data":"estado_usuario",
    "render": function(data, type, row) {
        if(data == "Activo"){
            return '<span class="available">'+data+'</span>'
        }else{
            return '<span class="away">'+data+'</span>'
        }      
    }
    },        
    {"data": null,
    "render": function (data) { 
                return '<a href="/edit/'+data.usuario+ '"class="btn btn-info"><i class="fas fa-edit"></i></a><a onclick="confirmar('+data.usuario+')" class="btn btn-danger"><i class="fas fa-trash-alt"></i></a>'                           
                }
        }
    ],
    bDestroy: true,
    pageLength : 5,
    lengthMenu: [[5, 10, 20, -1], [5, 10, 20, 'Todos']]     
     }); 

        $('#add_data').click(function() {

            $('#dynamic_modal_title').text('Add Data');

            $('#sample_form')[0].reset();

            $('#action').val('Add');

            $('#action_button').text('Add');

            $('#action_modal').modal('show');

        });
    }
        $('#sample_form').on('submit', function(event) {

            event.preventDefault();

            let url = "http://localhost:5001/auth/searchuser";
            $.ajax({
                url: url,
                method: "POST",
                data: $('#sample_form').serialize(),
                dataType: "JSON",
                beforeSend: function() {
                    
                },
                success: function(data) {
                    $('#action_button').attr('disabled', false);

                    $('#message').html('<div class="alert alert-success">' + data.message + '</div>');

                    $('#action_modal').modal('hide');

                    load_data();
                    setTimeout(function() {
                        $('#message').html('');
                    }, 5000);
                },
                error: function(){
                    alert('Error porfavor verifica que el usuario y dni no exista, Sino tu ');
                    $('#action_modal').modal('hide');
                }
            });

        });

        $(document).on('click', '.edit', function() {

            var id = $(this).data('id');

            $('#dynamic_modal_title').text('Edit Data');

            $('#action').val('Edit');

            $('#action_button').text('Edit');

            $('#action_modal').modal('show');

            $.ajax({
                url: "http://localhost:3000/sample_data/action",
                method: "POST",
                data: {
                    id: id,
                    action: 'fetch_single'
                },
                dataType: "JSON",
                success: function(data) {
                    $('#first_name').val(data.first_name);
                    $('#last_name').val(data.last_name);
                    $('#gender').val(data.gender);
                    $('#age').val(data.age);
                    $('#id').val(data.id);
                }
            });

        });

        $(document).on('click', '.delete', function() {

            var id = $(this).data('id');

            if (confirm("Are you sure you want to delete this data?")) {
                $.ajax({
                    url: "http://localhost:3000/sample_data/action",
                    method: "POST",
                    data: {
                        action: 'delete',
                        id: id
                    },
                    dataType: "JSON",
                    success: function(data) {
                        $('#message').html('<div class="alert alert-success">' + data.message + '</div>');
                        load_data();
                        setTimeout(function() {
                            $('#message').html('');
                        }, 5000);
                    }
                });
            }

        });
    });
</script>